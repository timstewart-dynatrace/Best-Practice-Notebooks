{"version":"7","defaultTimeframe":{"from":"now()-2h","to":"now()"},"defaultSegments":[],"sections":[{"id":"6a280bee-af22-4418-a91c-a05c8b0d1f02","type":"markdown","markdown":"# Deploying ActiveGate\n\n> **Series:** ONBRD | **Notebook:** 3 of 10 | **Created:** December 2025\n\n## Your Network Gateway to Dynatrace\n\nActiveGate is a lightweight component that routes traffic between your infrastructure and Dynatrace. This notebook covers when you need ActiveGate, how many to deploy, where to place them, and installation steps - including comprehensive Kubernetes deployment options.\n\n---\n\n## Table of Contents\n\n1. What is ActiveGate?\n2. When Do You Need ActiveGate?\n3. How Many ActiveGates? (Hardware Requirements)\n4. Where to Deploy?\n5. Generating Tokens\n6. Installation Methods (Linux/Windows/Container)\n6a. Kubernetes Deployment (Detailed)\n7. Verifying Deployment\n8. Troubleshooting\n9. Next Steps\n\n---\n\n## Prerequisites\n\n- Admin access to Dynatrace environment\n- Network architecture diagram (know your zones)\n- Server for ActiveGate (Linux, Windows, or Kubernetes cluster)\n- Outbound HTTPS (443) to Dynatrace SaaS"},{"id":"9cc993c2-2eba-4c01-bc0f-665ecd3aa9e0","type":"markdown","markdown":"## 1. What is ActiveGate?\n\nActiveGate is a proxy and routing component that connects your environment to Dynatrace.\n\n| Component | Purpose |\n|-----------|--------|\n| **Environment ActiveGate** | Routes OneAgent traffic, runs extensions, executes synthetics |\n| **Cluster ActiveGate** | Dynatrace Managed only - cluster communication |\n\n> **Note:** This notebook covers Environment ActiveGate for Dynatrace SaaS.\n\n![ActiveGate Architecture](../images/activegate-architecture.svg)\n<!-- MARKDOWN_TABLE_ALTERNATIVE\n| Zone | Component | Connection |\n|------|-----------|------------|\n| DMZ | ActiveGate | → Dynatrace SaaS (443) |\n| Internal | OneAgents | → ActiveGate (9999) |\n| Restricted | OneAgents | → ActiveGate (9999) |\n| Cloud | Extensions | → ActiveGate (9999) |\n-->\n\n### ActiveGate Capabilities\n\n| Capability | Description |\n|------------|-------------|\n| **Traffic Routing** | Proxies OneAgent data to Dynatrace |\n| **Extensions 2.0** | Runs Python-based extensions locally |\n| **Synthetic Monitoring** | Private synthetic locations |\n| **Cloud Integrations** | AWS, Azure, GCP metric collection |\n| **Kubernetes API** | Cluster monitoring via API |\n| **Log Ingest** | Generic log ingest endpoint |"},{"id":"701ee870-c6a5-4013-ad9d-e626d787eb4c","type":"markdown","markdown":"## 2. When Do You Need ActiveGate?\n\n### Required Scenarios\n\n| Scenario | Why ActiveGate is Required |\n|----------|---------------------------|\n| **Network-restricted hosts** | OneAgents can't reach internet directly |\n| **Private synthetic monitors** | Test internal applications |\n| **Extensions 2.0** | Custom data sources (SNMP, databases, etc.) |\n| **AWS/Azure/GCP monitoring** | Pull cloud metrics via API |\n| **VMware monitoring** | vCenter integration |\n| **Kubernetes full-stack** | Cluster API access for events, metrics |\n\n### Optional but Recommended\n\n| Scenario | Benefit |\n|----------|--------|\n| **Large deployments (500+ hosts)** | Reduces outbound connections |\n| **Multiple network zones** | Centralized routing per zone |\n| **Bandwidth optimization** | Compresses and batches data |\n| **Security compliance** | Single egress point for audit |\n\n### Decision Tree\n\n![ActiveGate Decision Tree](../images/activegate-decision-tree.svg)\n<!-- MARKDOWN_TABLE_ALTERNATIVE\n| Question | Yes → | No → |\n|----------|-------|------|\n| Can all hosts reach Dynatrace directly? | AG optional | AG required |\n| Need private synthetic monitoring? | AG required | Continue |\n| Using Extensions 2.0? | AG required | Continue |\n| Monitoring AWS/Azure/GCP? | AG required | Continue |\n| More than 500 hosts? | AG recommended | AG optional |\n-->"},{"id":"c2bc483b-bffa-4ff0-a601-e911b6eb3878","type":"markdown","markdown":"## 3. How Many ActiveGates?\n\n### Sizing Guidelines\n\n| ActiveGate Size | OneAgents Supported | Memory | CPU |\n|-----------------|---------------------|--------|-----|\n| **Small** | Up to 500 | 2 GB | 2 cores |\n| **Medium** | 500-1,500 | 4 GB | 4 cores |\n| **Large** | 1,500-3,000 | 8 GB | 8 cores |\n| **Extra Large** | 3,000-5,000 | 16 GB | 16 cores |\n\n### Detailed Hardware Requirements\n\n#### Minimum System Requirements\n\n| Component | Minimum | Recommended |\n|-----------|---------|-------------|\n| **CPU** | 2 cores (x64) | 4+ cores |\n| **RAM** | 2 GB | 4+ GB |\n| **Disk Space** | 2 GB | 10+ GB (for logs/cache) |\n| **Disk Type** | HDD | SSD (for extensions) |\n| **Network** | 100 Mbps | 1 Gbps |\n\n#### Operating System Support\n\n| OS | Supported Versions |\n|----|-------------------|\n| **RHEL/CentOS** | 7.x, 8.x, 9.x |\n| **Ubuntu** | 18.04, 20.04, 22.04, 24.04 LTS |\n| **Debian** | 10, 11, 12 |\n| **Amazon Linux** | 2, 2023 |\n| **SUSE** | 12 SP5, 15 SPx |\n| **Windows Server** | 2016, 2019, 2022 |\n\n#### Memory Sizing by Workload\n\n| Workload Type | Base Memory | Additional per Feature |\n|---------------|-------------|----------------------|\n| **Routing Only** | 2 GB | - |\n| **+ Extensions 2.0** | 2 GB | +1-2 GB per active extension |\n| **+ Synthetic** | 2 GB | +1 GB per 10 monitors |\n| **+ Cloud Integration** | 2 GB | +512 MB per cloud account |\n| **+ Log Ingest** | 2 GB | +2 GB for high volume |\n\n#### Disk Space Sizing\n\n| Purpose | Space Required |\n|---------|---------------|\n| **Base Installation** | 1.5 GB |\n| **Log Files (default)** | 1-5 GB (rotated) |\n| **Extension Cache** | 500 MB - 2 GB |\n| **Synthetic Cache** | 500 MB - 1 GB |\n| **Temporary Files** | 1 GB |\n| **Recommended Total** | 10-20 GB |\n\n> **Best Practice:** Mount `/opt/dynatrace` on a dedicated partition with at least 20 GB for production deployments.\n\n### High Availability\n\nFor production environments, deploy **at least 2 ActiveGates per network zone**:\n\n| Deployment | ActiveGates | Purpose |\n|------------|-------------|--------|\n| **Minimum HA** | 2 per zone | Failover capability |\n| **Recommended** | 2-3 per zone | Load distribution + failover |\n| **Large scale** | N+1 per zone | Capacity + redundancy |\n\n> **Key Point:** OneAgents automatically load-balance across available ActiveGates and failover if one becomes unavailable.\n\n### Example Deployment\n\n| Network Zone | Hosts | ActiveGates | Sizing | Memory | CPU |\n|--------------|-------|-------------|--------|--------|-----|\n| Production DMZ | 200 | 2 | Small | 2 GB each | 2 cores |\n| Production Internal | 800 | 2 | Medium | 4 GB each | 4 cores |\n| Development | 150 | 1 | Small | 2 GB | 2 cores |\n| **Total** | **1,150** | **5** | | **14 GB** | **14 cores** |"},{"id":"6a23b098-0195-492f-b3c9-785982127fea","type":"markdown","markdown":"## 4. Where to Deploy?\n\n### Network Zone Strategy\n\nDeploy ActiveGates based on network segmentation:\n\n![ActiveGate Placement](../images/activegate-placement.svg)\n<!-- MARKDOWN_TABLE_ALTERNATIVE\n| Zone Type | ActiveGate Location | OneAgent Connection |\n|-----------|--------------------|-----------------|\n| DMZ | In DMZ with internet access | Internal hosts → DMZ AG |\n| Internal | Internal segment | Internal hosts → Internal AG |\n| Cloud VPC | Within VPC | Cloud workloads → VPC AG |\n| Air-gapped | Edge with controlled egress | Isolated hosts → Edge AG |\n-->\n\n### Placement Rules\n\n| Rule | Description |\n|------|-------------|\n| **Same network zone** | AG should be in same zone as OneAgents it serves |\n| **Outbound access** | AG needs HTTPS to `*.dynatrace.com` |\n| **Inbound from agents** | OneAgents connect to AG on port 9999 |\n| **Low latency** | Place AG close to monitored workloads |\n\n### Cloud-Specific Guidance\n\n| Cloud | Recommendation |\n|-------|---------------|\n| **AWS** | Deploy in management VPC or shared services subnet |\n| **Azure** | Hub VNet with peering to spoke VNets |\n| **GCP** | Shared VPC host project |\n| **Kubernetes** | Deploy as StatefulSet or standalone VM outside cluster |"},{"id":"d85fdd7a-cdd4-4e7b-b6d2-778d668b9d20","type":"markdown","markdown":"## 5. Generating Tokens\n\nActiveGate requires a PaaS token for installation.\n\n**Location:** Settings → Integration → Platform as a Service\n\nOr use the API token approach:\n\n### Required Token Scopes\n\n| Scope | API Name | Purpose |\n|-------|----------|--------|\n| **PaaS integration - Installer download** | `InstallerDownload` | Download ActiveGate installer |\n\n### Additional Scopes by Use Case\n\n| Use Case | Additional Scopes |\n|----------|------------------|\n| **AWS Monitoring** | `aws.supportedServicesRead` |\n| **Azure Monitoring** | `azure.supportedServicesRead` |\n| **Extensions 2.0** | `extensions.read`, `extensions.write` |\n| **Synthetic Private Location** | `syntheticLocations.write` |\n\n### Token Naming Convention\n\nUse descriptive names:\n- `prod-activegate-dmz`\n- `aws-activegate-useast1`\n- `k8s-activegate-cluster1`"},{"id":"732dfa36-a735-4ebe-92bf-a6c2806ea080","type":"markdown","markdown":"## 6. Installation Methods\n\n### Linux Installation\n\n```bash\n# Download the installer\nwget -O Dynatrace-ActiveGate.sh \\\n  \"https://{tenant-id}.live.dynatrace.com/api/v1/deployment/installer/gateway/unix/latest?Api-Token={paas-token}\"\n\n# Make executable and run\nchmod +x Dynatrace-ActiveGate.sh\nsudo ./Dynatrace-ActiveGate.sh\n```\n\n### Windows Installation\n\n```powershell\n# Download the installer\nInvoke-WebRequest -Uri \"https://{tenant-id}.live.dynatrace.com/api/v1/deployment/installer/gateway/windows/latest?Api-Token={paas-token}\" -OutFile Dynatrace-ActiveGate.exe\n\n# Run the installer\n.\\Dynatrace-ActiveGate.exe\n```\n\n### Container Deployment (Docker/Podman)\n\n```bash\ndocker run -d --name dynatrace-activegate \\\n  -e DT_TENANT=\"{tenant-id}\" \\\n  -e DT_API_TOKEN=\"{paas-token}\" \\\n  -p 9999:9999 \\\n  dynatrace/activegate:latest\n```\n\n### Installation Parameters\n\n| Parameter | Purpose | Example |\n|-----------|---------|--------|\n| `--set-network-zone` | Assign to network zone | `--set-network-zone=dmz` |\n| `--set-group` | Group for management | `--set-group=production` |\n| `--enable-synthetic` | Enable synthetic capability | `--enable-synthetic` |"},{"id":"102e920f-2846-46ae-ab79-fd034d107c94","type":"markdown","markdown":"## 6a. Kubernetes Deployment (Detailed)\n\nDeploying ActiveGate in Kubernetes requires careful consideration of where, how, and when to use containerized ActiveGates vs. traditional VM deployments.\n\n### When to Deploy ActiveGate in Kubernetes\n\n| Scenario | Deploy in K8s? | Reasoning |\n|----------|----------------|-----------|\n| **Cluster-only monitoring** | ✅ Yes | Co-located with workloads, simplifies networking |\n| **Routing for in-cluster OneAgents** | ✅ Yes | Lower latency, no external hops |\n| **Extensions 2.0 for K8s resources** | ✅ Yes | Direct access to cluster APIs |\n| **Multi-cluster routing** | ⚠️ Consider | May need external AG for cross-cluster |\n| **Private synthetic monitoring** | ❌ Usually VM | Synthetic requires stable network, not pod restarts |\n| **Routing for external hosts** | ❌ VM preferred | External hosts need stable, routable IP |\n| **Air-gapped environments** | ❌ VM preferred | Often need dedicated proxy tier |\n\n### When NOT to Deploy in Kubernetes\n\n| Scenario | Why VM is Better |\n|----------|------------------|\n| **Routing for VMs/bare metal** | VMs need stable IPs, not pod IPs |\n| **Private synthetic locations** | Synthetic tests sensitive to pod restarts |\n| **Extensions polling external systems** | External systems may not allow K8s egress IPs |\n| **Compliance requiring dedicated hosts** | Some compliance requires dedicated hardware |\n\n### Deployment Architecture\n\n![ActiveGate Kubernetes Deployment](../images/activegate-k8s-deployment.svg)\n<!-- MARKDOWN_TABLE_ALTERNATIVE\n| Component | Location | Purpose |\n|-----------|----------|---------|\n| ActiveGate StatefulSet | dynatrace namespace | Routing, extensions |\n| Headless Service | dynatrace namespace | Pod DNS discovery |\n| LoadBalancer Service | dynatrace namespace | External access (optional) |\n| PVC (optional) | dynatrace namespace | Persistent logs/cache |\n| ConfigMap | dynatrace namespace | Custom configuration |\n| Secret | dynatrace namespace | API tokens |\n-->\n\n### Kubernetes Hardware Requirements\n\n| Deployment Size | CPU Request | CPU Limit | Memory Request | Memory Limit |\n|-----------------|-------------|-----------|----------------|--------------|\n| **Small** (≤500 agents) | 500m | 2000m | 1Gi | 2Gi |\n| **Medium** (500-1500) | 1000m | 4000m | 2Gi | 4Gi |\n| **Large** (1500-3000) | 2000m | 8000m | 4Gi | 8Gi |\n| **Extra Large** (3000+) | 4000m | 16000m | 8Gi | 16Gi |\n\n### Method 1: Dynatrace Operator (Recommended)\n\nThe Dynatrace Operator manages ActiveGate lifecycle automatically.\n\n```yaml\n# dynakube.yaml - ActiveGate via Operator\napiVersion: dynatrace.com/v1beta2\nkind: DynaKube\nmetadata:\n  name: dynakube\n  namespace: dynatrace\nspec:\n  apiUrl: https://{tenant-id}.live.dynatrace.com/api\n  \n  # ActiveGate configuration\n  activeGate:\n    # Capabilities to enable\n    capabilities:\n      - routing           # Route OneAgent traffic\n      - kubernetes-monitoring  # K8s API monitoring\n      - dynatrace-api     # Proxy Dynatrace API calls\n    \n    # Resource sizing\n    resources:\n      requests:\n        cpu: \"500m\"\n        memory: \"1Gi\"\n      limits:\n        cpu: \"2000m\"\n        memory: \"2Gi\"\n    \n    # Number of replicas (HA)\n    replicas: 2\n    \n    # Tolerations for dedicated nodes\n    tolerations:\n      - key: \"dedicated\"\n        operator: \"Equal\"\n        value: \"dynatrace\"\n        effect: \"NoSchedule\"\n    \n    # Node selector (optional)\n    nodeSelector:\n      node-type: monitoring\n    \n    # Custom properties\n    customProperties:\n      value: |\n        [connectivity]\n        networkZone=kubernetes\n    \n    # Labels\n    labels:\n      app.kubernetes.io/component: activegate\n```\n\n**Install with Operator:**\n\n```bash\n# Create namespace\nkubectl create namespace dynatrace\n\n# Create secret with tokens\nkubectl -n dynatrace create secret generic dynakube \\\n  --from-literal=apiToken=dt0c01.XXXXXXXX \\\n  --from-literal=paasToken=dt0c01.YYYYYYYY\n\n# Install Dynatrace Operator via Helm\nhelm repo add dynatrace https://raw.githubusercontent.com/Dynatrace/dynatrace-operator/main/config/helm/repos/stable\nhelm repo update\n\nhelm install dynatrace-operator dynatrace/dynatrace-operator \\\n  --namespace dynatrace \\\n  --set installCRD=true\n\n# Apply DynaKube configuration\nkubectl apply -f dynakube.yaml\n```\n\n### Method 2: Helm Chart (Standalone)\n\nFor more control, use the standalone ActiveGate Helm chart:\n\n```bash\n# Add Dynatrace Helm repo\nhelm repo add dynatrace https://raw.githubusercontent.com/Dynatrace/dynatrace-operator/main/config/helm/repos/stable\nhelm repo update\n\n# Create values file\ncat > activegate-values.yaml << 'EOF'\napiUrl: \"https://{tenant-id}.live.dynatrace.com/api\"\n\nactiveGate:\n  replicas: 2\n  \n  capabilities:\n    - routing\n    - kubernetes-monitoring\n  \n  resources:\n    requests:\n      cpu: 500m\n      memory: 1Gi\n    limits:\n      cpu: 2\n      memory: 2Gi\n  \n  # Persistent storage for logs\n  persistence:\n    enabled: true\n    size: 10Gi\n    storageClassName: gp3\n  \n  # Service configuration\n  service:\n    type: ClusterIP  # or LoadBalancer for external access\n  \n  # Environment variables\n  env:\n    - name: DT_NETWORK_ZONE\n      value: \"kubernetes\"\n\n# Token from existing secret\nexistingSecret: dynatrace-tokens\nEOF\n\n# Install\nhelm install activegate dynatrace/dynatrace-activegate \\\n  --namespace dynatrace \\\n  --values activegate-values.yaml\n```\n\n### Method 3: Raw Kubernetes Manifests\n\nFor complete control, use raw manifests:\n\n```yaml\n# activegate-namespace.yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: dynatrace\n---\n# activegate-secret.yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dynatrace-tokens\n  namespace: dynatrace\ntype: Opaque\nstringData:\n  apiToken: \"dt0c01.XXXXXXXXXXXXXXXX\"\n  paasToken: \"dt0c01.YYYYYYYYYYYYYYYY\"\n---\n# activegate-configmap.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: activegate-config\n  namespace: dynatrace\ndata:\n  custom.properties: |\n    [connectivity]\n    networkZone=kubernetes\n    \n    [collector]\n    MaxIncomingConnections=2000\n---\n# activegate-statefulset.yaml\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: activegate\n  namespace: dynatrace\n  labels:\n    app: activegate\nspec:\n  serviceName: activegate\n  replicas: 2\n  selector:\n    matchLabels:\n      app: activegate\n  template:\n    metadata:\n      labels:\n        app: activegate\n    spec:\n      serviceAccountName: dynatrace-activegate\n      containers:\n        - name: activegate\n          image: dynatrace/activegate:latest\n          imagePullPolicy: Always\n          env:\n            - name: DT_TENANT\n              value: \"{tenant-id}\"\n            - name: DT_API_TOKEN\n              valueFrom:\n                secretKeyRef:\n                  name: dynatrace-tokens\n                  key: paasToken\n            - name: DT_CAPABILITIES\n              value: \"routing,kubernetes_monitoring\"\n          ports:\n            - containerPort: 9999\n              name: ag-https\n          resources:\n            requests:\n              cpu: \"500m\"\n              memory: \"1Gi\"\n            limits:\n              cpu: \"2000m\"\n              memory: \"2Gi\"\n          volumeMounts:\n            - name: config\n              mountPath: /var/lib/dynatrace/gateway/config/custom.properties\n              subPath: custom.properties\n            - name: ag-data\n              mountPath: /var/lib/dynatrace/gateway\n          livenessProbe:\n            httpGet:\n              path: /rest/health\n              port: 9999\n              scheme: HTTPS\n            initialDelaySeconds: 30\n            periodSeconds: 15\n          readinessProbe:\n            httpGet:\n              path: /rest/health\n              port: 9999\n              scheme: HTTPS\n            initialDelaySeconds: 30\n            periodSeconds: 5\n      volumes:\n        - name: config\n          configMap:\n            name: activegate-config\n  volumeClaimTemplates:\n    - metadata:\n        name: ag-data\n      spec:\n        accessModes: [\"ReadWriteOnce\"]\n        storageClassName: gp3\n        resources:\n          requests:\n            storage: 10Gi\n---\n# activegate-service.yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: activegate\n  namespace: dynatrace\nspec:\n  type: ClusterIP  # Change to LoadBalancer for external access\n  selector:\n    app: activegate\n  ports:\n    - port: 443\n      targetPort: 9999\n      name: https\n---\n# Headless service for StatefulSet DNS\napiVersion: v1\nkind: Service\nmetadata:\n  name: activegate-headless\n  namespace: dynatrace\nspec:\n  clusterIP: None\n  selector:\n    app: activegate\n  ports:\n    - port: 9999\n      name: ag-https\n```\n\n### Exposing ActiveGate for External Access\n\nIf external hosts need to route through the K8s ActiveGate:\n\n```yaml\n# Option 1: LoadBalancer Service\napiVersion: v1\nkind: Service\nmetadata:\n  name: activegate-external\n  namespace: dynatrace\n  annotations:\n    # AWS NLB\n    service.beta.kubernetes.io/aws-load-balancer-type: \"nlb\"\n    service.beta.kubernetes.io/aws-load-balancer-scheme: \"internal\"\nspec:\n  type: LoadBalancer\n  selector:\n    app: activegate\n  ports:\n    - port: 443\n      targetPort: 9999\n---\n# Option 2: Ingress (with TLS passthrough)\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: activegate-ingress\n  namespace: dynatrace\n  annotations:\n    nginx.ingress.kubernetes.io/ssl-passthrough: \"true\"\n    nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\"\nspec:\n  ingressClassName: nginx\n  rules:\n    - host: activegate.internal.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: activegate\n                port:\n                  number: 443\n```\n\n### Platform-Specific Configurations\n\n#### Amazon EKS\n\n```yaml\n# EKS-specific annotations\napiVersion: v1\nkind: Service\nmetadata:\n  name: activegate\n  namespace: dynatrace\n  annotations:\n    service.beta.kubernetes.io/aws-load-balancer-type: \"nlb\"\n    service.beta.kubernetes.io/aws-load-balancer-internal: \"true\"\n    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: \"true\"\nspec:\n  type: LoadBalancer\n  # ...\n```\n\n#### Azure AKS\n\n```yaml\n# AKS-specific annotations\napiVersion: v1\nkind: Service\nmetadata:\n  name: activegate\n  namespace: dynatrace\n  annotations:\n    service.beta.kubernetes.io/azure-load-balancer-internal: \"true\"\nspec:\n  type: LoadBalancer\n  # ...\n```\n\n#### Google GKE\n\n```yaml\n# GKE-specific annotations  \napiVersion: v1\nkind: Service\nmetadata:\n  name: activegate\n  namespace: dynatrace\n  annotations:\n    cloud.google.com/load-balancer-type: \"Internal\"\nspec:\n  type: LoadBalancer\n  # ...\n```\n\n### High Availability in Kubernetes\n\n| Configuration | Setting |\n|---------------|---------|\n| **Replicas** | 2-3 for production |\n| **Pod Anti-Affinity** | Spread across nodes |\n| **PodDisruptionBudget** | minAvailable: 1 |\n| **Resource Requests** | Guarantee scheduling |\n\n```yaml\n# Pod Anti-Affinity for HA\nspec:\n  affinity:\n    podAntiAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        - labelSelector:\n            matchLabels:\n              app: activegate\n          topologyKey: kubernetes.io/hostname\n---\n# PodDisruptionBudget\napiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: activegate-pdb\n  namespace: dynatrace\nspec:\n  minAvailable: 1\n  selector:\n    matchLabels:\n      app: activegate\n```"},{"id":"b0a9d6fa-e231-45cb-8b8c-09f47546f004","type":"markdown","markdown":"## 7. Verifying Deployment\n\nAfter installation, verify ActiveGate is connected and healthy."},{"id":"2851706e-df9b-4dc8-b79e-3acb3371ffc1","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// List all ActiveGates and their status\nfetch dt.entity.active_gate\n| fields entity.name, state\n| sort entity.name"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"2faf93ed-9af1-4cfd-a854-c16fa30770e9","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// Check ActiveGate versions\nfetch dt.entity.active_gate\n| fields entity.name, state\n| sort entity.name"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"468a033f-6fdc-4ec3-a85c-df74fa65041b","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// Count ActiveGates \nfetch dt.entity.active_gate\n| summarize ag_count = count()"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"3c11caf6-77e0-4185-8974-095e946677f9","type":"markdown","markdown":"### Verification via UI\n\n**Location:** Deployment status → ActiveGates\n\nCheck for:\n- ✅ Status: Connected\n- ✅ Version: Latest or recent\n- ✅ Modules: Expected capabilities enabled\n\n### Verification Commands\n\n**Linux:**\n```bash\n# Check service status\nsudo systemctl status dynatracegateway\n\n# Check connectivity\ncurl -k https://localhost:9999/communication/health\n\n# View logs\nsudo tail -100 /var/log/dynatrace/gateway/gateway.log\n```\n\n**Windows:**\n```powershell\n# Check service status\nGet-Service -Name \"Dynatrace ActiveGate\"\n\n# Check connectivity\nInvoke-WebRequest -Uri \"https://localhost:9999/communication/health\" -SkipCertificateCheck\n```"},{"id":"d49dde5d-f17f-4630-b81a-e5488512c008","type":"markdown","markdown":"## 8. Troubleshooting\n\n### Common Issues\n\n| Issue | Cause | Solution |\n|-------|-------|----------|\n| **Not appearing in UI** | Network blocked | Check firewall for 443 outbound |\n| **Shows disconnected** | Service stopped | Restart dynatracegateway service |\n| **OneAgents not routing** | Wrong network zone | Verify zone configuration |\n| **High memory usage** | Too many agents | Add another AG or increase RAM |\n| **Certificate errors** | Self-signed cert issue | Trust Dynatrace CA or use custom cert |\n\n### Network Verification\n\n```bash\n# Test outbound to Dynatrace\ncurl -v https://{tenant-id}.live.dynatrace.com/communication/health\n\n# Test ActiveGate is listening\nnetstat -tlnp | grep 9999\n\n# Test from OneAgent host\ncurl -k https://{activegate-ip}:9999/communication/health\n```\n\n### Log Locations\n\n| OS | Log Path |\n|----|----------|\n| **Linux** | `/var/log/dynatrace/gateway/` |\n| **Windows** | `C:\\ProgramData\\dynatrace\\gateway\\log\\` |"},{"id":"24d4e4c9-88ab-4397-858e-e949ff36bec0","type":"markdown","markdown":"## 9. Next Steps\n\nWith ActiveGate deployed:\n\n1. **ONBRD-04: Deploying OneAgent** - Now deploy agents that route through ActiveGate\n2. Configure network zones if using multiple ActiveGates\n3. Enable additional modules (synthetic, extensions) as needed\n4. Set up monitoring for ActiveGate itself\n\n### Deployment Checklist\n\n#### Traditional (VM/Bare Metal)\n- [ ] ActiveGate deployed in each required network zone\n- [ ] At least 2 per zone for HA (production)\n- [ ] Status shows \"Connected\" in Dynatrace\n- [ ] Firewall rules configured (443 out, 9999 in)\n- [ ] Network zones configured (if applicable)\n- [ ] Sizing appropriate for expected OneAgent count\n\n#### Kubernetes\n- [ ] Dynatrace Operator installed (recommended)\n- [ ] DynaKube CR applied with activeGate configuration\n- [ ] Replicas set to 2+ for production HA\n- [ ] Resource requests/limits configured\n- [ ] PodDisruptionBudget created\n- [ ] Pod anti-affinity configured for spread across nodes\n- [ ] Service type appropriate (ClusterIP vs LoadBalancer)\n\n---\n\n## Summary\n\nIn this notebook, you learned:\n\n- What ActiveGate does and its capabilities\n- When ActiveGate is required vs. optional\n- Hardware requirements and sizing guidelines\n- How to size and plan ActiveGate deployment\n- Where to place ActiveGates in your network\n- Installation methods for Linux, Windows, and containers\n- **Kubernetes deployment** using Operator, Helm, or raw manifests\n- Platform-specific configurations for EKS, AKS, and GKE\n- How to verify successful deployment\n\n---\n\n## References\n\n### General\n- [ActiveGate Overview](https://docs.dynatrace.com/docs/setup-and-configuration/dynatrace-activegate)\n- [ActiveGate Installation](https://docs.dynatrace.com/docs/setup-and-configuration/dynatrace-activegate/installation)\n- [Network Zones](https://docs.dynatrace.com/docs/manage/network-zones)\n- [ActiveGate Sizing](https://docs.dynatrace.com/docs/setup-and-configuration/dynatrace-activegate/activegate-sizing)\n- [Private Synthetic Locations](https://docs.dynatrace.com/docs/platform-modules/digital-experience/synthetic-monitoring/private-synthetic-locations)\n\n### Kubernetes\n- [Dynatrace Operator](https://docs.dynatrace.com/docs/setup-and-configuration/setup-on-k8s/installation)\n- [Dynatrace Operator GitHub](https://github.com/Dynatrace/dynatrace-operator)\n- [ActiveGate on Kubernetes](https://docs.dynatrace.com/docs/setup-and-configuration/setup-on-k8s/guides/operation/activegate)\n- [DynaKube Custom Resource](https://docs.dynatrace.com/docs/setup-and-configuration/setup-on-k8s/reference/dynakube)\n- [Helm Chart Repository](https://github.com/Dynatrace/dynatrace-operator/tree/main/config/helm)"}],"name":"--ONBRD-03-deploying-activegate"}