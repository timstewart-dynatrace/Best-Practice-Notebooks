{"version":"7","defaultTimeframe":{"from":"now()-2h","to":"now()"},"defaultSegments":[],"sections":[{"id":"bc558fd2-830e-4b22-b214-6ac979beff96","type":"markdown","markdown":"# IAM and Authentication\n\n> **Series:** ONBRD | **Notebook:** 2 of 10 | **Created:** December 2025\n\n## Setting Up Secure Access\n\nBefore inviting your team, configure authentication and permissions properly. This notebook covers SAML/SSO setup, API tokens, and the modern permission model.\n\n---\n\n## Table of Contents\n\n1. Authentication Options\n2. SAML/SSO Configuration\n3. API Tokens\n4. Permission Model\n5. Creating Groups and Policies\n6. Next Steps\n\n---\n\n## Prerequisites\n\n- Account owner or admin access\n- Identity provider details (for SSO)\n- Understanding of your organization's access requirements"},{"id":"d32ad98e-8fb4-4337-b281-d89248c1a009","type":"markdown","markdown":"## 1. Why IAM First?\n\nSetting up IAM before deploying OneAgent or inviting users ensures:\n\n| Benefit | Why It Matters |\n|---------|----------------|\n| **Consistent access** | Users authenticate the same way from day one |\n| **Proper permissions** | No accidental admin access for viewers |\n| **Audit trail** | All access tied to corporate identity |\n| **Offboarding** | Disabling IdP account revokes Dynatrace access |\n| **Compliance** | Meet security requirements from the start |\n\n![Recommended Onboarding Order](../images/onboarding-order.svg)\n<!-- MARKDOWN_TABLE_ALTERNATIVE\n| Step | Description |\n|------|-------------|\n| 1. First Steps | Account access (ONBRD-01) |\n| 2. IAM Setup | Security configuration (ONBRD-02) |\n| 3. Deploy ActiveGate | Network routing (ONBRD-03) |\n| 4. Deploy OneAgent | Start monitoring (ONBRD-04) |\n| 5. Invite Team | Users join with proper access via IdP |\n-->"},{"id":"fb28e710-f903-43d8-8f3f-481da36943d4","type":"markdown","markdown":"## 2. Authentication Options\n\nDynatrace supports multiple authentication methods:\n\n| Method | Description | Best For |\n|--------|-------------|----------|\n| **Local Users** | Built-in user accounts | Small teams, testing, break-glass accounts |\n| **SAML 2.0** | Enterprise SSO integration | Most organizations |\n| **OIDC** | OpenID Connect integration | Modern identity providers |\n\n### Authentication Flow\n\n![SAML Authentication Flow](../images/saml-auth-flow.svg)\n<!-- MARKDOWN_TABLE_ALTERNATIVE\n| Step | Description |\n|------|-------------|\n| 1. Login | User requests access to Dynatrace |\n| 2. Redirect | Dynatrace redirects to Identity Provider |\n| 3. Auth + MFA | User authenticates with IdP |\n| 4. SAML Assertion | IdP sends encrypted assertion to Dynatrace |\n| 5. Access Granted | User is logged in |\n-->\n\n### Common Identity Providers\n\n- **Azure Active Directory (Entra ID)** - Microsoft environments\n- **Okta** - Cloud-native identity\n- **OneLogin** - Enterprise identity\n- **PingFederate** - On-premises/hybrid\n- **Google Workspace** - Google-centric organizations"},{"id":"1544bd18-73db-4ea1-91fd-3eb30e65965f","type":"markdown","markdown":"## 3. Configuring SAML SSO\n\n### Step 1: Access Account Management\n\n**Location:** Account Management → Identity & access management → Single sign-on\n\nYou'll need these values for your IdP configuration:\n\n| Field | Description |\n|-------|-------------|\n| **Entity ID** | Unique identifier for Dynatrace |\n| **ACS URL** | Assertion Consumer Service URL |\n| **Relay State** | Where users land after login |\n\n### Step 2: Configure Your Identity Provider\n\nIn your IdP, create a new SAML application with:\n\n1. **ACS URL** from Dynatrace\n2. **Entity ID** from Dynatrace\n3. **Name ID Format:** Email address (recommended)\n4. **Required Attributes:**\n   - `email` - User's email address\n   - `firstName` - User's first name\n   - `lastName` - User's last name\n\n### Step 3: Configure Dynatrace\n\n**Location:** Account Management → Identity & access management → Single sign-on\n\n1. Upload or paste the IdP metadata XML\n2. Or manually configure:\n   - **IdP Entity ID** - From your IdP\n   - **SSO URL** - Login endpoint\n   - **Certificate** - IdP signing certificate\n3. Configure attribute mappings\n4. Save and test\n\n### Step 4: Test SSO\n\nBefore enabling SSO for all users:\n\n1. Open an incognito/private browser window\n2. Navigate to your tenant URL (`https://{tenant-id}.apps.dynatrace.com`)\n3. Select \"Sign in with SSO\"\n4. Complete IdP authentication\n5. Verify you land in Dynatrace with correct permissions\n\n> **Warning:** Keep at least one local admin account as a break-glass option in case SSO fails."},{"id":"72b44c63-c7be-43df-b016-03d8d509aa4b","type":"markdown","markdown":"## 4. User Groups and Permissions\n\n### Permission Model\n\nDynatrace uses a policy-based access control model with the following permission levels:\n\n![Permission Hierarchy](../images/permission-hierarchy.svg)\n<!-- MARKDOWN_TABLE_ALTERNATIVE\n| Level | Access |\n|-------|--------|\n| Admin | Full access including user management |\n| Configurator | Change settings, configure monitoring |\n| Operator | View + acknowledge problems, create dashboards |\n| Viewer | Read-only access to data and dashboards |\n-->\n\n### Recommended Groups\n\n| Group | Role | Use Case |\n|-------|------|----------|\n| **Platform Admins** | Admin | Platform team, IAM management |\n| **SRE Team** | Configurator | Workflow setup, monitoring config |\n| **Developers** | Operator | Problem response, dashboards |\n| **Stakeholders** | Viewer | Reports, read-only access |\n\n### Creating Groups\n\n**Location:** Account Management → Identity & access management → Groups\n\n1. Click \"Create group\"\n2. Name the group (e.g., \"SRE-Team\")\n3. Add a description\n4. Assign policies (permissions)\n5. Optionally link to IdP groups for automatic membership\n\n### Scoping Access with Policies\n\nThe modern platform uses **policies** to control what users can access:\n\n| Policy Type | Purpose |\n|-------------|--------|\n| **Environment policies** | Access to specific environments |\n| **Account policies** | Account-level management |\n| **Data policies** | Access to specific data (via segments) |\n\n> **Note:** For data filtering, use **Segments** (covered in ONBRD-05) rather than the legacy Management Zones."},{"id":"978ec8f4-8f68-4d13-901a-11eb3aa6fa15","type":"markdown","markdown":"## 5. API Token and OAuth Management\n\nThe modern platform supports two authentication methods for API access:\n\n### API Tokens (for OneAgent, legacy integrations)\n\n**Location:** Account Management → Access tokens\n\n| Purpose | Required Scopes |\n|---------|----------------|\n| **OneAgent Deployment** | `InstallerDownload` |\n| **Metric Ingestion** | `metrics.ingest` |\n| **Log Ingestion** | `logs.ingest` |\n| **Read Entities** | `entities.read` |\n\n### OAuth 2.0 Clients (recommended for new integrations)\n\n**Location:** Account Management → OAuth clients\n\nOAuth 2.0 is the modern authentication method:\n\n1. Create an OAuth client\n2. Use client credentials flow to obtain bearer tokens\n3. Tokens are short-lived and automatically rotated\n\n### Token Best Practices\n\n| Practice | Why |\n|----------|-----|\n| **Minimal scope** | Limit blast radius if compromised |\n| **Descriptive names** | Know what each token is for |\n| **Expiration dates** | Force rotation, reduce risk |\n| **Separate tokens per use** | Revoke one without affecting others |\n| **Never commit to code** | Use environment variables or secrets managers |\n| **Prefer OAuth for new work** | Modern, short-lived tokens |\n\n### Creating an API Token\n\n1. Go to Account Management → Access tokens\n2. Click \"Generate new token\"\n3. Enter a descriptive name (e.g., \"prod-oneagent-deployment\")\n4. Select required scopes\n5. Set expiration (consider 90-365 days)\n6. Click \"Generate token\"\n7. **Copy the token immediately** - it won't be shown again"},{"id":"649cc192-052b-42fe-935b-a7bddf7315e4","type":"markdown","markdown":"## 6. Verification Queries\n\nAfter configuring IAM, verify your setup with these queries."},{"id":"f4221679-3ba2-4e25-9e57-5dd749a52219","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// Check recent audit log entries for user access\nfetch logs, from: now() - 24h\n| filter matchesPhrase(log.source, \"audit\")\n| fields timestamp, content\n| sort timestamp desc\n| limit 50"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"e2cecfbf-e3ea-45a3-9ba6-6e13d2032c8d","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// Check for authentication events (if audit logs enabled)\nfetch logs, from: now() - 7d\n| filter matchesPhrase(content, \"login\") or matchesPhrase(content, \"authentication\")\n| fields timestamp, content\n| sort timestamp desc\n| limit 25"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"dd0b9a3b-959b-47bf-95ab-a06bc3340dfa","type":"markdown","markdown":"### Manual Verification Checklist\n\n| Item | How to Verify |\n|------|---------------|\n| **SSO working** | Login via IdP in incognito window |\n| **Groups created** | Check Account Management → Groups |\n| **Permissions assigned** | Test with a viewer account |\n| **Break-glass account** | Local admin login still works |\n| **API tokens** | OneAgent deployment token ready |"},{"id":"74464e20-9bd4-467c-a21e-c506fe934027","type":"markdown","markdown":"## 7. Next Steps\n\nWith IAM configured, you're ready to:\n\n1. **ONBRD-03: Deploying ActiveGate** - Set up network routing (if needed for restricted networks)\n2. **ONBRD-04: Deploying OneAgent** - Start collecting infrastructure data\n3. Invite team members via your IdP\n4. Create additional API tokens or OAuth clients as needed\n\n### IAM Tasks Before Moving On\n\n- [ ] SAML/SSO configured and tested\n- [ ] Break-glass local admin account documented\n- [ ] User groups created for major roles\n- [ ] OneAgent deployment token generated\n- [ ] Token naming conventions established\n\n---\n\n## Summary\n\nIn this notebook, you learned:\n\n- Why IAM should be configured before deploying agents\n- Authentication options (Local, SAML, OIDC)\n- How to configure SAML SSO\n- Permission levels and group structure\n- API token and OAuth best practices\n- How to verify IAM configuration\n\n---\n\n## References\n\n- [Identity and Access Management](https://docs.dynatrace.com/docs/manage/identity-access-management)\n- [SAML Configuration](https://docs.dynatrace.com/docs/manage/identity-access-management/single-sign-on/saml-configuration)\n- [OIDC Configuration](https://docs.dynatrace.com/docs/manage/identity-access-management/single-sign-on/configure-oidc)\n- [Access Tokens](https://docs.dynatrace.com/docs/manage/access-control/access-tokens)\n- [OAuth Clients](https://docs.dynatrace.com/docs/manage/identity-access-management/oauth-clients)"}],"name":"--ONBRD-02-iam-and-authentication"}