{"version":"7","defaultTimeframe":{"from":"now()-2h","to":"now()"},"defaultSegments":[],"sections":[{"id":"025db65a-dedd-4415-bfc9-de5b18582f22","type":"markdown","markdown":"# Deploying OneAgent\n\n> **Series:** ONBRD | **Notebook:** 5 of 10 | **Created:** December 2025\n\n## Getting Data Into Dynatrace\n\nOneAgent is the foundation of Dynatrace monitoring. This notebook covers deployment strategies, installation methods, and verification steps to ensure your infrastructure is reporting data.\n\n---\n\n## Table of Contents\n\n1. What is OneAgent?\n2. Deployment Strategy\n3. Generating a Deployment Token\n4. Installation Methods\n5. Kubernetes Deployment\n6. Verifying Deployment\n7. Troubleshooting\n8. Next Steps\n\n---\n\n## Prerequisites\n\n- Admin access to Dynatrace environment\n- API token with `InstallerDownload` scope (created in ONBRD-02)\n- Root/admin access to target hosts\n- Network access from hosts to Dynatrace (port 443) or ActiveGate (ONBRD-03)\n- Cloud integrations configured (ONBRD-04) for full context"},{"id":"41fe900b-3481-453a-ad22-a1a40b490b1e","type":"markdown","markdown":"## 1. What is OneAgent?\n\nOneAgent is Dynatrace's unified monitoring agent that:\n\n| Capability | Description |\n|------------|-------------|\n| **Auto-discovery** | Automatically detects hosts, processes, services |\n| **Full-stack** | Infrastructure, application, and user experience |\n| **Zero configuration** | Works immediately after installation |\n| **Distributed tracing** | End-to-end transaction visibility |\n| **Log collection** | Collects and forwards log data |\n\n![OneAgent Architecture](../images/oneagent-architecture.svg)\n<!-- MARKDOWN_TABLE_ALTERNATIVE\n| Component | Location | Function |\n|-----------|----------|----------|\n| OneAgent | Host | Unified monitoring agent |\n| Process Monitoring | Inside OneAgent | Monitors each running process |\n| Infrastructure Monitoring | Inside OneAgent | CPU, Memory, Disk metrics |\n| Log Collection | Inside OneAgent | Collects application logs |\n| Dynatrace Cluster | Cloud | Analysis, storage, alerting |\n-->"},{"id":"8c0b4dc9-6042-4fda-aee5-6af070c22802","type":"markdown","markdown":"## 2. Deployment Strategy\n\n### Phased Rollout (Recommended)\n\nDon't deploy everywhere at once. Use a phased approach:\n\n| Phase | Scope | Purpose |\n|-------|-------|--------|\n| **Pilot** | 2-5 non-critical hosts | Validate installation, network, discovery |\n| **Expand** | One application tier | Test service detection, tracing |\n| **Production** | Full environment | Complete coverage |\n\n### Deployment Methods by Environment\n\n| Environment | Recommended Method |\n|-------------|-------------------|\n| **Bare metal/VMs** | Direct install or package manager |\n| **Kubernetes** | Dynatrace Operator |\n| **OpenShift** | Dynatrace Operator |\n| **AWS ECS** | Task definition sidecar |\n| **Azure** | VM Extension or AKS Operator |\n| **GCP** | Direct install or GKE Operator |\n\n### Network Requirements\n\nOneAgent needs outbound HTTPS (443) to:\n- `*.apps.dynatrace.com` (SaaS)\n\nIf direct access isn't possible, OneAgents connect through **ActiveGate** (see ONBRD-03)."},{"id":"fcb61fae-0464-47f4-80a0-b5542464a0f8","type":"markdown","markdown":"## 3. Generating a Deployment Token\n\nYou need an API token with installer download permissions.\n\n**Location:** Account Management → Access tokens → Generate new token\n\n### Required Scope\n\n| Scope | API Name | Purpose |\n|-------|----------|--------|\n| **PaaS integration - Installer download** | `InstallerDownload` | Download OneAgent installer |\n\n### Token Naming Convention\n\nUse descriptive names:\n- `prod-oneagent-deployment`\n- `dev-installer-token`\n- `k8s-operator-token`\n\n> **Important:** Copy the token immediately after creation. It won't be shown again."},{"id":"309c5e82-df54-4d79-8476-e5f471dccdb0","type":"markdown","markdown":"## 4. Installation Methods\n\n### Linux (Direct Download)\n\n```bash\n# Download the installer\nwget -O Dynatrace-OneAgent.sh \\\n  \"https://{tenant-id}.apps.dynatrace.com/api/v1/deployment/installer/agent/unix/default/latest?Api-Token={token}&arch=x86&flavor=default\"\n\n# Run the installer\nsudo /bin/sh Dynatrace-OneAgent.sh\n```\n\n### Linux (One-liner)\n\n```bash\nwget -O Dynatrace-OneAgent.sh \"https://{tenant-id}.apps.dynatrace.com/api/v1/deployment/installer/agent/unix/default/latest?Api-Token={token}\" && sudo /bin/sh Dynatrace-OneAgent.sh\n```\n\n### Windows (PowerShell)\n\n```powershell\n# Download the installer\nInvoke-WebRequest -Uri \"https://{tenant-id}.apps.dynatrace.com/api/v1/deployment/installer/agent/windows/default/latest?Api-Token={token}\" -OutFile Dynatrace-OneAgent.exe\n\n# Run the installer\n.\\Dynatrace-OneAgent.exe\n```\n\n### Configuration Management\n\nFor Ansible, Puppet, Chef, or other tools, see:\n- [Ansible Collection](https://docs.dynatrace.com/docs/setup-and-configuration/dynatrace-oneagent/installation-and-operation/linux/installation/install-oneagent-on-linux#expand--oneagent-deployment-automation-with-ansible--2)\n- [Puppet Module](https://forge.puppet.com/modules/dynatrace/dynatrace_oneagent)\n- [Chef Cookbook](https://supermarket.chef.io/cookbooks/dynatrace)"},{"id":"9d29acaf-4bcf-4f2d-ab43-88cb9b9833fe","type":"markdown","markdown":"## 5. Kubernetes Deployment\n\nFor Kubernetes environments, use the Dynatrace Operator.\n\n### Prerequisites\n\n- `kubectl` access to cluster\n- API token with required scopes\n- Cluster admin permissions\n\n### Required Token Scopes for Kubernetes\n\n| Scope | Purpose |\n|-------|---------|\n| `InstallerDownload` | Download OneAgent |\n| `entities.read` | Read topology |\n| `settings.read` | Read configuration |\n| `settings.write` | Write configuration |\n| `DataExport` | Export data (optional) |\n\n### Installation Steps\n\n1. **Navigate to Kubernetes monitoring**\n   - Infrastructure → Kubernetes → Add cluster\n\n2. **Follow the wizard**\n   - Select your distribution\n   - Choose observability options\n   - Download dynakube.yaml\n\n3. **Apply to cluster**\n   ```bash\n   kubectl apply -f https://github.com/Dynatrace/dynatrace-operator/releases/download/v1.3.2/kubernetes.yaml\n   kubectl apply -f dynakube.yaml\n   ```\n\n4. **Verify deployment**\n   ```bash\n   kubectl get pods -n dynatrace\n   ```"},{"id":"3f44b3f5-9e6e-40cb-b247-3d9fd67bfd25","type":"markdown","markdown":"## 6. Verifying Deployment\n\nAfter installation, verify OneAgent is reporting data."},{"id":"44cd6f9f-0940-47b0-bfba-69623788f922","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// Check all hosts with OneAgent\nfetch dt.entity.host\n| fields entity.name, state, monitoringMode\n| filter state == \"RUNNING\"\n| sort entity.name\n| limit 50"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"98cd7907-9fa7-4441-805e-385cb9f2e77c","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// Check hosts by monitoring state\nfetch dt.entity.host\n| summarize host_count = count(), by: {state, monitoringMode}\n| sort host_count desc"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"7b6a3452-ecbc-4675-98b6-2680a9103d43","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// Check hosts by monitoring state - useful for verifying deployment\nfetch dt.entity.host\n| fields entity.name, state, monitoringMode\n| summarize host_count = count(), by: {state}\n| sort host_count desc"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"e2dea631-a9ae-4b6d-a7b0-05dd8b4f1032","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// Check discovered services\nfetch dt.entity.service\n| fields entity.name, serviceType\n| summarize service_count = count(), by: {serviceType}\n| sort service_count desc"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"fb3f8ed6-87a8-41e6-98f1-d8665fe3275e","type":"dql","filterSegments":[],"drilldownPath":[],"previousFilterSegments":[],"height":250,"state":{"input":{"timeframe":{"from":"now()-2h","to":"now()"},"value":"// Check for processes discovered\nfetch dt.entity.process_group\n| fields entity.name\n| sort entity.name\n| limit 50"},"visualizationSettings":{"table":{"hideColumnsForLargeResults":true},"autoSelectVisualization":true,"chartSettings":{}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"visualization":"table"}},{"id":"6434c3e6-687e-417f-ad7d-7a4e91c990c9","type":"markdown","markdown":"### Host Verification Commands\n\n**Linux:**\n```bash\n# Check OneAgent status\nsudo systemctl status oneagent\n\n# Check connection to Dynatrace\nsudo /opt/dynatrace/oneagent/agent/tools/oneagent-connection-check\n\n# Check OneAgent logs\nsudo tail -100 /var/log/dynatrace/oneagent/oneagent.log\n```\n\n**Windows:**\n```powershell\n# Check service status\nGet-Service -Name \"Dynatrace OneAgent\"\n\n# Check connection\n& \"C:\\Program Files\\dynatrace\\oneagent\\agent\\tools\\oneagent-connection-check.exe\"\n```"},{"id":"e12b844a-a894-4a74-aa5a-059ebf8ccc8e","type":"markdown","markdown":"## 7. Troubleshooting\n\n### Common Issues\n\n| Issue | Cause | Solution |\n|-------|-------|----------|\n| **Host not appearing** | Network blocked | Check firewall rules for 443 |\n| **Host showing but no data** | Agent not running | Restart OneAgent service |\n| **Services not discovered** | Processes not restarted | Restart monitored applications |\n| **Old OneAgent version** | Auto-update disabled | Enable auto-update or manual upgrade |\n| **Connection errors** | Proxy required | Configure ActiveGate or proxy |\n\n### Network Verification\n\n```bash\n# Test connectivity to Dynatrace\ncurl -v https://{tenant-id}.apps.dynatrace.com/api/v1/time\n\n# Check DNS resolution\nnslookup {tenant-id}.apps.dynatrace.com\n\n# Test with OpenSSL\nopenssl s_client -connect {tenant-id}.apps.dynatrace.com:443\n```\n\n### Process Restart Requirement\n\nOneAgent injects into running processes. After initial installation:\n\n- **New processes** - Automatically monitored\n- **Existing processes** - Restart required for full monitoring\n\nFor deep code-level visibility, restart:\n- Application servers (Tomcat, JBoss, etc.)\n- Web servers (Apache, Nginx, IIS)\n- .NET/Java applications\n- Node.js applications"},{"id":"f9f49eda-9123-4b45-a99a-c1fcd9502ee5","type":"markdown","markdown":"## 8. Next Steps\n\nWith OneAgent deployed and verified:\n\n1. **ONBRD-06: Organizing Your Environment** - Set up tags, segments, and naming conventions\n2. Wait 15-30 minutes for full topology discovery\n3. Check Smartscape for service dependencies\n4. Plan broader rollout based on pilot results\n\n### Deployment Checklist\n\n- [ ] Pilot hosts deployed (2-5 hosts)\n- [ ] Hosts appearing in Dynatrace\n- [ ] OneAgent status \"RUNNING\" on all hosts\n- [ ] Services being discovered\n- [ ] Connection check passing\n- [ ] Smartscape showing topology\n\n---\n\n## Summary\n\nIn this notebook, you learned:\n\n- What OneAgent does and how it works\n- Phased deployment strategy\n- How to generate deployment tokens\n- Installation methods for Linux, Windows, and Kubernetes\n- How to verify successful deployment\n- Common troubleshooting steps\n\n---\n\n## References\n\n- [OneAgent Overview](https://docs.dynatrace.com/docs/setup-and-configuration/dynatrace-oneagent)\n- [Linux Installation](https://docs.dynatrace.com/docs/setup-and-configuration/dynatrace-oneagent/installation-and-operation/linux/installation/install-oneagent-on-linux)\n- [Windows Installation](https://docs.dynatrace.com/docs/setup-and-configuration/dynatrace-oneagent/installation-and-operation/windows/installation/install-oneagent-on-windows)\n- [Kubernetes Operator](https://docs.dynatrace.com/docs/ingest-from/setup-on-k8s)\n- [Deployment API](https://docs.dynatrace.com/docs/dynatrace-api/environment-api/deployment)"}],"name":"--ONBRD-05-deploying-oneagent"}