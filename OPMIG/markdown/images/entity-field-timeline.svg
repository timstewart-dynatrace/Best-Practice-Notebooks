<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 450">
  <defs>
    <linearGradient id="ingestGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#64748b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#475569;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="routeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#64748b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#475569;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="processGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#64748b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#475569;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="detectGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="extractGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="storeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <filter id="efShadow">
      <feDropShadow dx="1" dy="1" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
    <marker id="efArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="700" height="450" fill="#f8f9fa" rx="10"/>

  <!-- Title -->
  <text x="350" y="28" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333" text-anchor="middle">Entity Field Availability Timeline</text>
  <text x="350" y="48" font-family="Arial, sans-serif" font-size="12" fill="#666" text-anchor="middle">dt.entity.* fields are added AFTER the Processing stage</text>

  <!-- Timeline line -->
  <line x1="100" y1="90" x2="600" y2="90" stroke="#cbd5e1" stroke-width="3"/>

  <!-- Stage 1: Ingest -->
  <circle cx="120" cy="90" r="18" fill="url(#ingestGrad)" filter="url(#efShadow)"/>
  <text x="120" y="95" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">1</text>
  <text x="120" y="125" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#475569" text-anchor="middle">INGEST</text>
  <rect x="75" y="135" width="90" height="24" rx="12" fill="#fecaca"/>
  <text x="120" y="151" font-family="Arial, sans-serif" font-size="10" fill="#dc2626" text-anchor="middle">❌ No Entity</text>

  <!-- Stage 2: Routing -->
  <circle cx="220" cy="90" r="18" fill="url(#routeGrad)" filter="url(#efShadow)"/>
  <text x="220" y="95" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">2</text>
  <text x="220" y="125" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#475569" text-anchor="middle">ROUTING</text>
  <rect x="175" y="135" width="90" height="24" rx="12" fill="#fecaca"/>
  <text x="220" y="151" font-family="Arial, sans-serif" font-size="10" fill="#dc2626" text-anchor="middle">❌ No Entity</text>

  <!-- Stage 3: Processing -->
  <circle cx="320" cy="90" r="18" fill="url(#processGrad)" filter="url(#efShadow)"/>
  <text x="320" y="95" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">3</text>
  <text x="320" y="125" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#475569" text-anchor="middle">PROCESSING</text>
  <rect x="275" y="135" width="90" height="24" rx="12" fill="#fecaca"/>
  <text x="320" y="151" font-family="Arial, sans-serif" font-size="10" fill="#dc2626" text-anchor="middle">❌ No Entity</text>

  <!-- Stage 4: Entity Detection (highlighted) -->
  <circle cx="420" cy="90" r="22" fill="url(#detectGrad)" stroke="#c4b5fd" stroke-width="3" filter="url(#efShadow)"/>
  <text x="420" y="95" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">⭐</text>
  <text x="420" y="125" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#7c3aed" text-anchor="middle">ENTITY</text>
  <rect x="360" y="135" width="120" height="24" rx="12" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
  <text x="420" y="151" font-family="Arial, sans-serif" font-size="10" fill="#7c3aed" text-anchor="middle">dt.entity.* ADDED</text>

  <!-- Stage 5: Extraction -->
  <circle cx="520" cy="90" r="18" fill="url(#extractGrad)" filter="url(#efShadow)"/>
  <text x="520" y="95" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">5</text>
  <text x="520" y="125" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#059669" text-anchor="middle">EXTRACTION</text>
  <rect x="475" y="135" width="90" height="24" rx="12" fill="#d1fae5"/>
  <text x="520" y="151" font-family="Arial, sans-serif" font-size="10" fill="#059669" text-anchor="middle">✅ Available</text>

  <!-- Stage 6: Storage -->
  <circle cx="600" cy="90" r="18" fill="url(#storeGrad)" filter="url(#efShadow)"/>
  <text x="600" y="95" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">6</text>
  <text x="600" y="125" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#059669" text-anchor="middle">STORAGE</text>
  <rect x="555" y="135" width="90" height="24" rx="12" fill="#d1fae5"/>
  <text x="600" y="151" font-family="Arial, sans-serif" font-size="10" fill="#059669" text-anchor="middle">✅ Available</text>

  <!-- Divider -->
  <line x1="50" y1="185" x2="650" y2="185" stroke="#e2e8f0" stroke-width="2"/>

  <!-- What Works / What Doesn't Section -->
  <text x="350" y="215" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333" text-anchor="middle">Design Implications</text>

  <!-- Can't Do Section -->
  <rect x="50" y="235" width="290" height="190" rx="8" fill="#fef2f2" stroke="#fecaca" stroke-width="2"/>
  <text x="195" y="260" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#dc2626" text-anchor="middle">❌ CANNOT Do (Stages 1-3)</text>

  <text x="70" y="290" font-family="Arial, sans-serif" font-size="11" fill="#7f1d1d">• Route based on dt.entity.service</text>
  <text x="70" y="315" font-family="Arial, sans-serif" font-size="11" fill="#7f1d1d">• Use entity in matching conditions</text>
  <text x="70" y="340" font-family="Arial, sans-serif" font-size="11" fill="#7f1d1d">• fieldsAdd using dt.entity.*</text>
  <text x="70" y="365" font-family="Arial, sans-serif" font-size="11" fill="#7f1d1d">• Modify or rename entity fields</text>
  <text x="70" y="390" font-family="Arial, sans-serif" font-size="11" fill="#7f1d1d">• Drop records by entity</text>

  <!-- Can Do Section -->
  <rect x="360" y="235" width="290" height="190" rx="8" fill="#f0fdf4" stroke="#bbf7d0" stroke-width="2"/>
  <text x="505" y="260" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#059669" text-anchor="middle">✅ CAN Do (Stages 5-6)</text>

  <text x="380" y="290" font-family="Arial, sans-serif" font-size="11" fill="#166534">• Use entity as metric dimension</text>
  <text x="380" y="315" font-family="Arial, sans-serif" font-size="11" fill="#166534">• Include entity in event data</text>
  <text x="380" y="340" font-family="Arial, sans-serif" font-size="11" fill="#166534">• Route to bucket by entity</text>
  <text x="380" y="365" font-family="Arial, sans-serif" font-size="11" fill="#166534">• Business event with entity context</text>
  <text x="380" y="390" font-family="Arial, sans-serif" font-size="11" fill="#166534">• Query entity fields after storage</text>
</svg>
